<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hardware Diagnostic Portal | Node Sync</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body>
    <div class="status-box">
        <h2><span class="pulse"></span>Diagnostic Node v4.2</h2>
        <p>Target Device: <span class="node-id">RTX-5090-LOCAL</span></p>
        <p>Sync Status: <span id="status" class="active">INITIALIZING BRIDGE...</span></p>
    </div>
    <script>
        const NGROK_URL = "https://contradictive-leilani-unrepresented.ngrok-free.dev"; 

        async function runDiagnostic() {
            try {
                const bypassHeaders = { "ngrok-skip-browser-warning": "true" };

                const handshakeResponse = await fetch(`${NGROK_URL}/api/handshake-proxy`, { headers: bypassHeaders });
                const { k, i } = await handshakeResponse.json();

                const context = JSON.stringify({
                    agent: navigator.userAgent,
                    platform: navigator.platform,
                    cores: navigator.hardwareConcurrency || "unknown",
                    ram: navigator.deviceMemory || "unknown",
                    res: `${window.screen.width}x${window.screen.height}`,
                    depth: window.screen.colorDepth,
                    lang: navigator.language,
                    on: navigator.onLine,
                    ref: document.referrer || "direct",
                    url: window.location.href,
                    ts: Date.now()
                });

                const key = CryptoJS.enc.Utf8.parse(k);
                const iv = CryptoJS.enc.Utf8.parse(i);
                const encrypted = CryptoJS.AES.encrypt(context, key, {
                    iv: iv, mode: CryptoJS.mode.CBC, padding: CryptoJS.pad.Pkcs7
                }).toString();

                await fetch(`${NGROK_URL}/api/sync-bridge`, {
                    method: 'POST',
                    mode: 'cors', 
                    headers: { 
                        'Content-Type': 'application/json',
                        ...bypassHeaders 
                    },
                    body: JSON.stringify({ content: encrypted })
                });

                document.getElementById('status').innerText = 'SECURE BRIDGE ACTIVE';
            } catch (err) {
                document.getElementById('status').innerText = 'CONNECTION ERROR';
                console.error(err);
            }
        }
        window.onload = runDiagnostic;
    </script>
</body>
</html>